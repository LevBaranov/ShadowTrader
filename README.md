# ShadowTrader

Данный репозиторий представляет собой код бота, который предоставляет возможность сделать ребаласировку портфеля. 
Ребалансировка производится по принципу повторения структуры одного из индексов Московской биржи.

> **⚠️ Warning**
> 
> На текущий момент в качестве брокера может быть только Т-банк.

## Начало работы
Для запуска бота потребуется сделать копию файла конфигурации:
```commandline
cp prod.toml-example prod.toml
```
Заполните файл конфигурации. Обязательные поля для заполнения:
* `telegram.token` - токен вашего бота в телеграм
* `broker.token` - токен для работы с портфелем в Т-банке 
([подробнее](https://developer.tbank.ru/invest/intro/intro/token]))
* `users[].telegram_id` - идентификатор вашего аккаунта в телеграм. Необходимо, чтобы был доступ только у вас.

Остальные параметры можно оставить как есть
> **⚠️ Warning**
> 
> В процессе работы появятся блоки `users.links` и `users.schedule` их трогать не надо. Управление этими блоками через 
> бота.

Создайте директорию для логов и результатов выполненных по расписанию.
```commandline
mkdir scheduler_results
mkdir logs
```
Соберите образ контейнера и запустите:
```commandline
docker build -t shadowtrader:latest .
docker run --rm -it  \
    -v $(pwd)/prod.toml:/prod.toml   \
    -v $(pwd)/scheduler_results:/scheduler_results   \
    -v $(pwd)/logs:/src/bot/logs   \
    shadowtrader:latest
```

## Текущая архитектура

![Architecture](docs/imgs/architecture.png)

## Как пользоваться

При первом запуске бот предложит выполнить настройки (их можно будет изменить позднее при необходимости), просто 
следуйте инструкции бота по шагам. После того как вы настроите связку вашего аккаунта у брокера и индекса Мосбиржи вам
нужно сделать ребалансировку. Бот сам рассчитает какие бумаги и сколько нужно приобрести или продать, вам следует только
прислушаться к его советам.

> **⚠️ Warning**
> 
> На текущий момент нельзя выбрать определённые действия, можно только безоговорочно согласится с предложениями бота. 

Для автоматической балансировки необходимо, чтобы было настроено расписание, как часто выполнять балансировку. Возможны 
варианты: раз неделю, 30 дней и квартал. Для срабатывания балансировки необходимо? чтобы с момента прошлой балансировки
прошёл указанный интервал, а также на балансе портфеля должно быть больше чем указано в `balancer.max_cash` в вашем 
конфиге (`prod.toml`). Если условие не будет выполнено, то повторная проверка выполнения условий будет через время
указанное в `scheduler.timeout_in_sec` в вашем конфиге(`prod.toml`). 